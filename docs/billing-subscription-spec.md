# サブスク課金仕様（Stripe）

## ステータス（2026-02-17時点）
- 本ドキュメントは現行仕様（サブスク方式）。
- プリペイド導線は廃止。

## 目的
- データ使用量ベースのプラン運用を、ユーザー選択型サブスクとして明確化する。
- 課金サイクル、プラン変更、停止条件を統一する。

## 前提
- データ使用量は常時計測（毎月リセットしない）。
- 「毎月1日 00:00 JST」はデータ更新ではなく、請求期間の切替タイミング。
- 決済は Stripe を利用する。

## プラン
- `FREE`: `<= 512MB` / `¥0`
- `BASIC`: `>512MB かつ <=1GB` / `¥980`
- `PLUS`: `>1GB かつ <=5GB` / `¥1,980`
- `PRO`: `>5GB かつ <=10GB` / `¥2,980`
- `>10GB` はアップロード停止（上位プラン追加まで）

## 基本ルール
- プランは自動変更しない。ユーザーが選択したプランを有効プランとする。
- 有効プラン上限を超えたら、アップロードを停止する（閲覧/削除などは継続）。
- 上位プランへの変更は即時反映し、当月は差額のみ請求する。
- 下位プランへの変更は次月反映とする（当月即時ダウンはしない）。

## 下位変更の制約
- 下位変更は `現在使用量 <= 変更先プラン上限` の場合のみ受付する。
- 予約済みの下位変更も、反映直前（毎月1日）に再チェックする。
- 反映直前に上限超過している場合は、下位変更を見送り（キャンセル）し通知する。

## 解約
- 解約は次回更新日前日まで受付。
- 当月末で解約（日割り返金なし）。

## Stripe 運用方針
- 月額管理は Stripe Subscription を利用。
- 期中アップグレードは proration（差額）を即時請求。
- Webhook を正として反映する（画面リダイレクト結果は補助）。

### 主要Webhookイベント
- `invoice.paid`
- `invoice.payment_failed`
- `customer.subscription.updated`
- `customer.subscription.deleted`

## 管理画面で表示する情報
- 現在プラン
- 使用量 / 上限
- 次回更新日（毎月1日）
- 予約中の変更（解約/ダウングレード）
- 上位変更時の差額見込み

## 備考
- `docs/billing-spec.md` は廃止済みプリペイド仕様のアーカイブ。
